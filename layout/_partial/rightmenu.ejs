<% if (theme.rightmenu && theme.rightmenu.enable == true && theme.rightmenu.layout.length > 0) { %>
  <% function loadmenu(obj) { %>
    <li>
      <a class='vlts-menu' <%= obj.url ? 'href='+ url_for(obj.url)+'' : ''%>
        <% if (obj.rel) { %>
          rel="<%- obj.rel %>"
        <% } %>
        <% if (obj.target) { %>
          target="<%- obj.target %>"
        <% } %>
        <% if (obj.onclick) { %>
          onclick="<%- obj.onclick %>"
        <% } %>
        <% if (obj.id) { %>
          id="<%- obj.id %>"
        <% } else if (obj.url) { %>
          id="<%= url_for(obj.url).replace(/\/|%|\./g, "")?url_for(obj.url).replace(/\/|%|\./g, ""):"home" %>"
        <% } %>>
        <% if (obj.icon) { %><i class='<%= obj.icon %> fa-fw'></i><% } %> <%- obj.name %>
      </a>
    </li>
  <% } %>

  <div id="rightmenu-wrapper">
    <ul class="list-v rightmenu" id="rightmenu-content">
      <% theme.rightmenu.layout.forEach(function(item){ %>
        <% if (item == 'hr') { %>
          <hr>
        <% } else if (item == 'navigation') { %>
          <li class='navigation'>
            <a class='nav fix-cursor-pointer' onclick='history.back()'><i class='fal fa-arrow-left fa-fw'></i></a>
            <a class='nav fix-cursor-pointer' onclick='history.forward()'><i class='fal fa-arrow-right fa-fw'></i></a>
            <a class='nav fix-cursor-pointer' onclick='window.location.reload()'><i class='fal fa-redo fa-fw'></i></a>
            <a class='nav fix-cursor-pointer' href='/'><i class='fal fa-home fa-fw'></i></a>
          </li>
        <% } else if (item == 'music') { %>
          <li class='navigation'>
            <a title='Play' class='nav fix-cursor-pointer' onclick='menuPlay()'><i class='fal fa-play fa-fw'></i></a>
            <a title='Pause' class='nav fix-cursor-pointer' onclick='menuPause()'><i class='fal fa-pause fa-fw'></i></a>
            <a title='Backward' class='nav fix-cursor-pointer' onclick='menuBackward()'><i class='fal fa-backward fa-fw'></i></a>
            <a title='Forward' class='nav fix-cursor-pointer' onclick='menuForward()'><i class='fal fa-forward fa-fw'></i></a>
          </li>
        <% } else if (item in theme.rightmenu) { %>
          <% loadmenu(theme.rightmenu[item]) %>
        <% } %>
      <% }) %>
    </ul>
  </div>

  <script>
    window.document.oncontextmenu = function () {
      return false;
    };
    document.addEventListener("click", function (event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      mymenu.style.display = "none";
    });
    function popMenu(event) {
      if($(window).width() <= 500) return true;

      var copy = document.getElementById('menu-copy');
      var select = window.getSelection().toString(); // 鼠标选中的文本
      copy.style.display = select == "" ? "none" : "block";

      var mymenu = document.getElementById('rightmenu-wrapper');
      var menuContent = document.getElementById('rightmenu-content');
      var mouseClientX = event.clientX;
      var mouseClientY = event.clientY;
      var menuWidth = menuContent.offsetWidth == 0 ? 154 : menuContent.offsetWidth;
      var menuHeight = menuContent.offsetHeight == 0 ? 302 : menuContent.offsetHeight;
      var screenWidth = document.documentElement.clientWidth || document.body.clientWidth;
      var screenHeight = document.documentElement.clientHeight || document.body.clientHeight;
      var showLeft = mouseClientX + menuWidth > screenWidth ? mouseClientX - menuWidth + 10 : mouseClientX;
      var showTop = mouseClientY + menuHeight > screenHeight ? mouseClientY - menuHeight + 10 : mouseClientY;
      mymenu.style.left = showLeft + "px"; // 获取鼠标位置
      mymenu.style.top = showTop + "px";
      mymenu.style.display = 'block';
      return false;
    }
    function hideMenu() {
      document.getElementById('rightmenu-wrapper').style.display = 'none';
    }
    function menuCopy() {
      document.execCommand("Copy");
      $.message({title:'复制成功',message: window.getSelection().toString(),type:'success'});
    }
    function menuPlay() {
    var canplay = getCookie('canplay');
    if( canplay == null || canplay == 'true') {
      document.querySelector('meting-js').aplayer.play();
    } else {
      $.message({title: "音乐通知",message: "音乐加载失败，建议刷新~",type:'warning'});
    }
  }
  function menuPause() {
    var canplay = getCookie('canplay');
    if( canplay == null || canplay == 'true') {
      document.querySelector('meting-js').aplayer.pause();
      var index = document.querySelector('meting-js').aplayer.list.index;
      var title = document.querySelector('meting-js').aplayer.list.audios[index].title;
      var artist = document.querySelector('meting-js').aplayer.list.audios[index].artist;
      $.message({title:'音乐通知',message: '暂停播放：' + title + ' - ' + artist, type:'success'});
    } else {
      $.message({title: "音乐通知",message: "音乐加载失败，建议刷新~",type:'warning'});
    }
  }
  function menuBackward() {
    var canplay = getCookie('canplay');
    if( canplay == null || canplay == 'true') {
      document.querySelector('meting-js').aplayer.skipBack();
      document.querySelector('meting-js').aplayer.play();
    } else {
      $.message({title: "音乐通知",message: "音乐加载失败，建议刷新~",type:'warning'});
    }
  }
  function menuForward() {
    var canplay = getCookie('canplay');
    if( canplay == null || canplay == 'true') {
      document.querySelector('meting-js').aplayer.skipForward();
      document.querySelector('meting-js').aplayer.play();
    } else {
      $.message({title: "音乐通知",message: "音乐加载失败，建议刷新~",type:'warning'});
    }
  }
  </script>
<% } %>
