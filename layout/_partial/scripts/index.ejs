<!-- required -->
<%- js(theme.plugins.jquery) %>

<!-- fancybox -->
<% if (theme.plugins.fancybox && theme.plugins.fancybox.enable) { %>
  <%- partial('../../_third-party/fancybox/script') %>
<% } %>

<!-- internal -->
<%- partial('cover') %>
<% if (theme.rightmenu.enable == true) { %>
  <%- partial('../rightmenu') %>
<% } %>

<% if (theme.plugins.lazyload && theme.plugins.lazyload.enable) { %>
  <%- partial('../../_third-party/lazyload/script') %>
<% } %>

<% if (theme.plugins.preload.enable && theme.plugins.preload.service) { %>
  <% let preload = theme.plugins.preload; %>
  <% if (preload.service == 'instant_page') { %>
    <script async src="<%- preload.instant_page %>" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
  <% } else if (preload.service == 'flying_pages') { %>
    <script>
      window.FPConfig = {
        delay: 0,
        ignoreKeywords: [],
        maxRPS: 5,
        hoverDelay: 25
      };
    </script>
    <script defer src="<%- preload.flying_pages %>"></script>
  <% } %>
<% } %>


<% if (theme.plugins.clipboard.enable && (theme.custom_css.body.highlight.copy_btn == true)) { %>
  <%- partial('../../_third-party/clipboard/script') %>
<% } %>

<% if (theme.plugins.scrollreveal.enable && theme.plugins.scrollreveal.js) { %>
   <%- partial('../../_third-party/scrollreveal/script') %>
<% } %>

<% if (theme.plugins.aplayer && theme.plugins.aplayer.enable && theme.plugins.aplayer.js) { %>
  <%- partial('../../_third-party/aplayer/script') %>
<% } %>

<% if (theme.comments.service && theme.comments.service.length > 0) { %>
  <%- partial('../../_third-party/comments/' + theme.comments.service + '/script') %>
<% } %>

<% if (theme.plugins.darkmodejs.enable) { %>
  <%- partial('darkmode') %>
<% } %>

<% if (theme.analytics.busuanzi) { %>
  <script defer src="<%- theme.analytics.busuanzi %>" data-pjax></script>
<% } %>

<!-- 2020/9/2 极致优化 -->
<!-- <% if (config.use_cdn && theme.info.cdn && theme.info.cdn.js) { %>
  <%- js(theme.info.cdn.js) %>
<% } else { %>
  <%- js(['js/app.js']) %>
<% } %> -->
<script>
// 处理向上按钮
window.addEventListener("scroll", function () {
  let scrollTop = document.body.scrollTop == 0 ? document.documentElement.scrollTop : document.body.scrollTop;
  if (scrollTop > 240) {
    document.getElementsByClassName('s-top')[0].classList.add("show");
  } else {
    document.getElementsByClassName('s-top')[0].classList.remove("show");
  }
})

document.getElementsByClassName('s-top')[0].addEventListener("click", function () {
  window.scrollTo({
    top: 0,
    behavior: "smooth"
  })
});

//处理移动端的搜索按钮
document.getElementsByClassName('s-search')[0].addEventListener("click", function (e) {
  e.stopPropagation();
  if (document.getElementsByClassName('l_header')[0].classList.value.indexOf('z_search-open') != -1) {
    document.getElementsByClassName('l_header')[0].classList.remove('z_search-open');
  } else {
    document.getElementsByClassName('l_header')[0].classList.add('z_search-open');
  }

  if (document.getElementsByClassName('s-search')[0].classList.value.indexOf('active') != -1) {
    document.getElementsByClassName('s-search')[0].classList.remove('active');
  } else {
    document.getElementsByClassName('s-search')[0].classList.add('active');
  }
});

document.getElementsByClassName('u-search-input')[0].addEventListener("click", function (e) {
  e.stopPropagation();  // 阻断搜索输入框的点击事件
});

//处理移动端的菜单按钮
document.getElementsByClassName('switcher nav-list-h m-phone')[1].lastChild.addEventListener("click", function (e) {
  e.stopPropagation();
  document.getElementsByClassName('menu-phone list-v navigation white-box')[0].style.display='block';
});


// dom 点击时，去掉搜索
document.addEventListener("click", function (e) {
  e.stopPropagation();
  document.getElementsByClassName('l_header')[0].classList.remove('z_search-open');
  document.getElementsByClassName('s-search')[0].classList.remove('active');
  document.getElementsByClassName('menu-phone list-v navigation white-box')[0].style.display='none';
});
</script>

<!-- optional -->
<% if (theme.search && theme.search.enable) { %>
  <%- partial('search') %>
<% } %>


<% if (theme.plugins.nodewaves.enable) { %>
  <%- js({src: theme.plugins.nodewaves.js}) %>
  <script type="text/javascript">
    $(function () {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>
<% } %>

<% if (theme.plugins.comment_typing.enable) { %>
  <%- js(theme.plugins.comment_typing.js) %>
<% } %>

<% if (theme.plugins.highlightjs.enable) { %>
  <% if (theme.plugins.highlightjs.js) { %>
    <%- js(theme.plugins.highlightjs.js) %>
    <script>hljs.initHighlightingOnLoad();</script>
  <% } %>
<% } %>

<% if (theme.analytics && theme.analytics.leancloud && theme.analytics.leancloud.app_id) { %>
  <%- partial('counter') %>
<% } %>

<!-- more -->
<% if (config.import && config.import.script) { %>
  <%- partial('import') %>
<% } %>
